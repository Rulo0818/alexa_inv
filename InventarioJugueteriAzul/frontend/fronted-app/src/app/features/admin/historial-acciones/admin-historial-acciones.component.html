<div class="historial-acciones">
  <h1 class="titulo">üìÅ Historial de Acciones</h1>
  <p class="subtitulo">Registro completo de todas las actividades del sistema</p>

  <div class="stats-row">
    <div class="stat-card">
      <h3>ACCIONES HOY</h3>
      <p class="stat-value">{{ stats()?.acciones_hoy ?? '-' }}</p>
    </div>
    <div class="stat-card">
      <h3>VENTAS HOY</h3>
      <p class="stat-value">{{ stats()?.ventas_hoy ?? '-' }}</p>
    </div>
    <div class="stat-card">
      <h3>CAMBIOS GUARDADOS</h3>
      <p class="stat-value">{{ stats()?.cambios_guardados_hoy ?? '-' }}</p>
    </div>
    <div class="stat-card">
      <h3>USUARIOS ACTIVOS</h3>
      <p class="stat-value">{{ stats()?.usuarios_activos_hoy ?? '-' }}</p>
    </div>
  </div>

  <div class="filters-section">
    <div class="filter-row">
      <div class="field">
        <label>FECHA INICIO</label>
        <input type="date" [ngModel]="fechaInicio()" (ngModelChange)="fechaInicio.set($event)" />
      </div>
      <div class="field">
        <label>FECHA FIN</label>
        <input type="date" [ngModel]="fechaFin()" (ngModelChange)="fechaFin.set($event)" />
      </div>
      <div class="field">
        <label>USUARIO</label>
        <select [ngModel]="usuarioFiltro()" (ngModelChange)="usuarioFiltro.set($event)">
          <option value="">Todos los usuarios</option>
          @for (e of empleados(); track e.id) {
            <option [value]="e.id">{{ e.nombre }} {{ e.apellido }}</option>
          }
        </select>
      </div>
      <div class="field">
        <label>TIPO DE ACCION</label>
        <select [ngModel]="tipoFiltro()" (ngModelChange)="tipoFiltro.set($event)">
          <option value="">Todas las acciones</option>
          <option value="login">Login</option>
          <option value="venta">Venta</option>
          <option value="venta_cancelada">Venta cancelada</option>
          <option value="producto_crear">Producto agregado</option>
          <option value="producto_editar">Producto editado</option>
          <option value="producto_eliminar">Producto eliminado</option>
          <option value="categoria_crear">Categoria agregada</option>
          <option value="categoria_editar">Categoria editada</option>
          <option value="categoria_eliminar">Categoria eliminada</option>
          <option value="usuario_crear">Usuario creado</option>
          <option value="usuario_editar">Usuario editado</option>
          <option value="usuario_eliminar">Usuario eliminado</option>
          <option value="usuario_resetear_password">Contrasena resetada</option>
        </select>
      </div>
    </div>
    <div class="filter-row">
      <input
        type="text"
        class="search-input"
        [ngModel]="searchText()"
        (ngModelChange)="searchText.set($event)"
        placeholder="Buscar por descripcion, usuario o ID..."
      />
      <button type="button" class="btn-filtrar" (click)="aplicarFiltros()">Aplicar Filtros</button>
    </div>
  </div>

  <div class="timeline-wrap">
    @if (loading()) {
      <p class="loading">Cargando historial...</p>
    } @else {
      <div class="timeline">
        @for (a of acciones(); track a.id) {
          <div class="timeline-item">
            <div class="timeline-marker" [ngClass]="getIconClass(a.tipo_accion)"></div>
            <div class="timeline-content">
              <div class="timeline-header">
                <span class="titulo-accion">{{ getTitulo(a.tipo_accion) }}</span>
                <span class="badge" [ngClass]="getLabelClass(a.tipo_accion)">{{ getLabel(a.tipo_accion) }}</span>
              </div>
              <p class="por">Por: {{ a.nombre }} {{ a.apellido }} ({{ rolTexto(a.nombre_rol) }})</p>
              <p class="descripcion">{{ a.descripcion }}</p>
              <span class="timestamp">{{ formatFecha(a.fecha_creacion) }}</span>
            </div>
          </div>
        }
        @empty {
          <p class="empty">No hay acciones en el periodo seleccionado</p>
        }
      </div>
    }
  </div>
</div>
